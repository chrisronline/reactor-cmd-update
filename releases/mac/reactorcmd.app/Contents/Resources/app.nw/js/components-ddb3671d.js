!function(){"use strict";angular.module("reactorCmd",["ui.router","ui.bootstrap","ngTable","auth0","angular-storage","angular-jwt","angular-promise-cache","angular-float-labels","cfp.loadingBar","angularFileUpload","angular-ladda"])}(),function(){"use strict";function e(e){e.init({domain:t,clientID:"Iaf0VktNKSUjztkr34F9FaeqB1f2Xzv0",loginState:"login"})}var t="barnstormingapps.auth0.com";e.$inject=["authProvider"];var n={ARN:"arn:aws:iam::919642224396:saml-provider/Auth0",ROLE:"arn:aws:iam::919642224396:role/Auth0_User",DOMAIN:t,API_URL:"http://localhost:3003"};angular.module("reactorCmd").config(e).constant("Auth0Config",n).run(["auth",function(e){e.hookEvents()}]).run(["Auth0Config","$location",function(e,t){"localhost"!==t.$$host&&(e.API_URL="http://server-env-xzhkjj6wyk.elasticbeanstalk.com")}])}(),function(){"use strict";var e={REGION:"us-east-1",TEAM_TABLE:"teams-present-barnstormingapps",FILES_TABLE:"files-capture-barnstormingapps",PRESENTATIONS_TABLE:"presentations-present-barnstormingapps",PRESENTATIONS_METADATA_TABLE:"metadata-present-barnstormingapps"};angular.module("reactorCmd").constant("AwsConfig",e)}(),function(){"use strict";function e(e){e.decorator("$log",["$delegate",function(e){var t=/%[sdifoOc]/;return e.get=function(n){return _.transform(_.functions(e),function(r,i){r[i]=function(){var r=Array.prototype.slice.call(arguments),a=r.shift(),o="%s %s %s";return _.isString(a)&&t.test(a)&&(o+=" "+a,a=""),r.unshift(o,moment().format("HH:MM:SS"),n,a),e[i].apply(e,r)}})},e}])}e.$inject=["$provide"],angular.module("reactorCmd").config(e)}(),function(){"use strict";function e(e){e.when("","dashboard")}e.$inject=["$urlRouterProvider","$locationProvider"],angular.module("reactorCmd").config(e).run(["$rootScope","$log",function(e,t){var n=t.get("$state");e.$on("$stateChangeError",function(){n.debug("$stateChangeError")})}])}(),function(){"use strict";angular.module("reactorCmd").run(["$templateCache",function(e){e.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()">\n    <ol class="carousel-indicators" ng-show="slides.length > 1">\n        <li ng-repeat="slide in slides track by $index" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n    <div class="carousel-inner" ng-transclude></div>\n    <a class="left carousel-control" ng-click="prev()" ng-show="slides.length > 1"><span class="fa fa-chevron-left"></span></a>\n    <a class="right carousel-control" ng-click="next()" ng-show="slides.length > 1"><span class="fa fa-chevron-right"></span></a>\n</div>\n')}])}(),function(){"use strict";function e(e){e.decorator("auth",["$delegate","$rootScope","store","PromisifyService","jwtHelper","$state","$http","$log","EventService","AUTH_EVENTS","S3Service","DynamodbService","Auth0Config","$urlRouter","AUTH_ROLES","LoadingService",function(e,t,n,r,i,a,o,s,l,u,c,m,d,f,g,p){function v(){$._isAdmin=_.contains($.profile.roles,g.REACTOR_ADMIN),$._isTeamAdmin=_.contains($.profile.roles,g.TEAM_ADMIN),$._isTeamOwner=_.contains($.profile.roles,g.TEAM_OWNER),$._displayName=$.profile.firstName&&$.profile.lastName?$.profile.firstName+" "+$.profile.lastName:$.profile.firstName?$.profile.firstName:$.profile.nickname||$.profile.email,$._visibleRoles=b(),A.debug("updateStatics() auth=%o",$)}function b(){var e=_.clone(g);return $._isAdmin?e:(e=_.omit(e,"REACTOR_ADMIN"),$._isTeamOwner?e:(e=_.omit(e,"TEAM_OWNER"),$._isTeamAdmin?e:e=_.omit(e,"TEAM_ADMIN")))}function h(){l.emit(u.LOGIN)}function T(){l.emit(u.LOGOUT)}function y(){A.debug("initServices()");var e={api:"aws",principal:d.ARN,role:d.ROLE,scope:"openid",id_token:$.idToken};return p.busy(),r.single(_.bind($.config.auth0js.getDelegationToken,$.config.auth0js),e).then(function(e){var t=new AWS.Credentials(e.Credentials.AccessKeyId,e.Credentials.SecretAccessKey,e.Credentials.SessionToken);c.init(t),m.init(t)}).finally(p.idle)}var $=e,A=s.get("AuthService");return $.manage=function(){t.$on("$stateChangeStart",function(e,t,n){var r=$.isAuthed();A.debug("$stateChangeStart() to=%s authed=%s",t.name,r),"login"===t.name?r&&(e.preventDefault(),A.debug("$stateChangeStart() redirecting to dashboard"),a.go("dashboard")):r?$.profile||(e.preventDefault(),$.getProfile().then(v).then(y).then(h).then(function(){A.debug("$stateChangeStart() redirecting to "+t.name),a.go(t.name,n)})):(e.preventDefault(),A.debug("$stateChangeStart() redirecting to login"),a.go("login"))}),$.isAuthed()&&($.profile=null)},$.logout=function(){$.signout(),n.remove("profile"),n.remove("token"),T()},$.auth=function(){return r.double($.signin,{}).then(function(e){A.debug("auth() response=%o",e),n.set("profile",e[0]),n.set("token",e[1])}).then(v).then(y).then(h)},$.isAuthed=function(){if($.isAuthenticated)return!0;try{var e=n.get("token"),t=n.get("profile");if(e&&!i.isTokenExpired(e))return $.authenticate(t,e),!0}catch(r){return A.warn("Exception raised trying to read from local storage",r),n.remove("token"),n.remove("profile"),!1}return!1},$.apiRequest=function(e,t,n){A.debug("apiRequest() method=%s url=%s payload=%o",e,t,n);var r=$.idToken,i={method:e,headers:{Authorization:"Bearer "+r},url:t,data:n};return o(i).then(function(e){return e.data})},$.stripProfileAttributes=function(e){return _.omit(e,["_id","connection","user_id","identities","created_at","name","email","email_verified","nickname","picture","given_name","family_name","access_token","access_token_secret"])},$.whenLogin=function(e){$.isAuthenticated&&$.profile?e():l.listen(u.LOGIN,e)},e}])}var t={LOGIN:"login",LOGOUT:"logout"};e.$inject=["$provide"],angular.module("reactorCmd").config(e).constant("AUTH_EVENTS",t).run(["$rootScope","auth","$state",function(e,t){t.manage(),e.auth=t}])}(),function(){"use strict";var e={REACTOR_ADMIN:"reactor_admin",TEAM_OWNER:"team_owner",TEAM_ADMIN:"team_admin",USER:"user"};angular.module("reactorCmd").constant("AUTH_ROLES",e)}(),function(){"use strict";function e(e){e.state("dashboard",{url:"/dashboard",controller:"DashboardCtrl",controllerAs:"dashboardCtrl",templateUrl:"components/dashboard/dashboard.html"})}function t(e,t){{var n=this;e.get("DashboardCtrl")}n.user=t.profile}e.$inject=["$stateProvider"],t.$inject=["$log","auth"],angular.module("reactorCmd").config(e).controller("DashboardCtrl",t)}(),function(){"use strict";function e(e){var t={};return t.show=function(t){return e.open(t).result},t}var t={CONFIRM:{templateUrl:"components/dialogs/confirm/confirm.dialog.html",controller:"ConfirmDialogCtrl",controllerAs:"confirmDialogCtrl"},AUTH0AUTH:{templateUrl:"components/dialogs/auth0auth/auth0auth.dialog.html",controller:"Auth0AuthDialogCtrl",controllerAs:"auth0authDialogCtrl"},PRESENTATION:{templateUrl:"components/presentation/presentation.dialog.html",controller:"PresentationDialogCtrl",controllerAs:"presentationDialogCtrl"},PRESENTATION_SLIDE_EDIT:{templateUrl:"components/presentation/slide/edit/presentation.slide.edit.dialog.html",controller:"PresentationSlideEditDialogCtrl",controllerAs:"presentationSlideEditDialogCtrl"}};e.$inject=["$modal"],angular.module("reactorCmd").constant("DIALOGS",t).factory("DialogService",e)}(),function(){"use strict";function e(e,t){return{restrict:"E",templateUrl:"components/nav/nav.html",link:function(n){function r(){e.getAvailableTeams().then(function(e){n.teams=e})}t.whenLogin(r)}}}e.$inject=["TeamService","auth"],angular.module("reactorCmd").directive("topNavigation",e)}(),function(){"use strict";function e(e,t,n,r,i,a,o){function s(){l.loading=!0,t.load(n).then(function(e){l.presentation=e}).finally(function(){l.loading=!1})}var l=this;l.close=function(){t.unload(),e.dismiss("close")},l.edit=function(){var e=_.find(l.presentation.slides,{active:!0}),n=_.extend({},a.PRESENTATION_SLIDE_EDIT,{resolve:{$$slide:function(){return e},$$manifest:function(){return l.presentation._manifest},$$slideCount:function(){return l.presentation.slides.length}}});i.show(n).then(function(n){_.extend(e,n,{_lastIndex:e._index}),t.indexSlides(l.presentation),l.presentation.slides=_.sortBy(l.presentation.slides,"_index")})},l.add=function(){},l.save=function(){o.busy("PresentationSave"),t.save(l.presentation,r).then(function(){console.log("saved")}).finally(_.partial(o.idle,"PresentationSave"))},s()}e.$inject=["$modalInstance","PresentationService","$$url","$$presentationObj","DialogService","DIALOGS","LoadingService"],angular.module("reactorCmd").controller("PresentationDialogCtrl",e)}(),function(){"use strict";function e(e,t,n,r,i,a,o){function s(e,t){var n=new RegExp(t,"i"),i=_.find(e.files,function(e){return n.test(e.name)});return i||r.warn(g,"Unable to find file in zip, fileName="+t),i}function l(e,t){var n=s(e,t);return n?e.file(n.name).asArrayBuffer():void 0}function u(e,t){var n=s(e,t);if(n){var i=e.file(n.name).asText(),a=null;try{a=JSON.parse(i)}catch(o){r.error(g,"Unable to parse json from file, file="+n.name+", message="+o.message)}return a}}function c(e,t){var n=e.lastIndexOf(".");return n>-1?e.substr(n+1):"images"===t?"png":"videos"===t?"mp4":void 0}function m(e){return"images"===e?"image":"videos"===e?"video":void 0}function d(e,t,n){n._manifest={},_.each(t.content,function(t,r){_.each(t,function(t,a){var o=l(e,t),s=c(t,r),u=m(r),d=new Blob([o],{type:u+"/"+s}),f=window.URL.createObjectURL(d);v.push(f),n._manifest[a]={type:u,buffer:o,url:i.trustAsResourceUrl(f)}})})}var f={},g=e.get("PresentationService"),p="presentation-data.json",v=[];return f.load=function(e){return g.debug("load() url=%s",e),n.busy(),t.single(JSZipUtils.getBinaryContent,e).then(function(e){var t=new JSZip(e),n=u(t,p),r=u(t,n.content_manifest_file);return d(t,r,n),n._zip=t,f.indexSlides(n),g.debug("zip=%o manifest=%o presentation=%o",t,r,n),n}).catch(_.partial(r.error,g)).finally(n.idle)},f.indexSlides=function(e){g.debug("indexSlides() slides=%o",e.slides);var t=_.filter(e.slides,"_lastIndex");_.each(t,function(t){e.slides.splice(t._lastIndex-1,1),e.slides.splice(t._index-1,0,t)}),e.slides=_.map(e.slides,function(e,t){return e._index=t+1,e._id=e._id||_.uniqueId("slide_"),e})},f.unload=function(){_.each(v,function(e){window.URL.revokeObjectURL(e)})},f.save=function(e,t){var n=a.clean(e);e._zip.file(p,JSON.stringify(n));var r=e._zip.generate({type:"blob"});return o.backupFile(t.s3_key,t.s3_bucket).then(function(){return o.uploadFile(t.s3_key,"application/zip",r,t.s3_bucket)})},f}e.$inject=["$log","PromisifyService","LoadingService","ErrorService","$sce","CleanService","S3Service"],angular.module("reactorCmd").factory("PresentationService",e)}(),function(){"use strict";function e(e,t,n,r,i,a,o,s,l,u,c){function m(e){return e._pristine=_.extend({},e),e._displayName=e.firstName&&e.lastName?e.firstName+" "+e.lastName:e.firstName?e.firstName:e.nickname||e.email,e._displayNameLowerCase=e._displayName.toLowerCase(),e._rolesString=e.roles?e.roles.join(","):"",e._editable=a._isAdmin||!e.roles,e.roles&&!a._isAdmin&&(_.intersection(e.roles,[u.TEAM_ADMIN,u.TEAM_OWNER]).length&&a._isTeamOwner&&(e._editable=!0),_.intersection(e.roles,[u.TEAM_ADMIN]).length&&a._isTeamAdmin&&(e._editable=!0),0===_.intersection(e.roles,[u.TEAM_ADMIN,u.TEAM_OWNER,u.REACTOR_ADMIN]).length&&(e._editable=!0)),e}function d(e){var t=e.cms_s3_bucket,n=t?t.lastIndexOf("/"):-1;return n>-1&&(e.cms_s3_bucket=t.substr(0,n),e.cms_s3_bucket_prefix=t.substr(n+1)),e}function f(e,t,n){return e._formattedKey=e.Key.indexOf("/")>-1?e.Key.substr(e.Key.lastIndexOf("/")+1):e.Key,e._contentType=e.ContentType,e._isImage=0===e._contentType.indexOf("image/"),e._previewUrl=r.getSignedAssetUrl(t,n,e._formattedKey,e.ContentType),e._downloadUrl=r.getSignedAssetUrl(t,n,e._formattedKey),e}function g(){return a._isAdmin?(v.debug("getAvailableTeams() all teams"),n.getTeams()):a._isTeamAdmin||a._isTeamOwner?(v.debug("getAvailableTeams() team=%s",a.profile.team),n.getTeam(a.profile.team)):(v.debug("getAvailableTeams() no teams"),i.failure())}var p={},v=e.get("TeamService");return p.getAvailableTeams=function(){return c({key:"TeamService.getAvailableTeams",ttl:-1,promise:function(){return g().then(function(e){return _.map(e,d)})}})},p.getTeam=function(e){return p.getAvailableTeams().then(function(n){var r=_.find(n,{team_id:e});return r?d(r):(v.warn("getTeam() team not found",e),t.reject())})},p.getAssets=function(e){return n.getFiles(e.team_id).then(function(t){return _.map(t,function(t){return t._downloadUrl=r.getSignedAssetUrl(e.capture_s3_bucket,null,t.file_key),t._previewUrl=r.getSignedAssetUrl(e.capture_s3_bucket,null,t.file_key,"image/jpg"),t})})},p.getPresentations=function(e){return n.getPresentations(e).then(function(e){return _.map(e,function(e){return e._downloadUrl=r.getSignedAssetUrl(e.s3_bucket,null,e.s3_key),e})})},p.getFiles=function(e){return v.debug("getFiles() team=%o",e),r.getFiles(e.cms_s3_bucket,e.cms_s3_bucket_prefix).then(function(t){return _.map(t,function(t){return f(t,e.cms_s3_bucket,e.cms_s3_bucket_prefix)})})},p.getFile=function(e,t,n){return v.debug("getFile() key=%s bucket=%s prefix=%s",e,t,n),r.getFile(e,t,n).then(function(r){return f(_.extend(r,{Key:e}),t,n)})},p.uploadFile=function(e,t,n){return v.debug("uploadFile() file=%o bucket=%s prefix=%s",e,t,n),r.uploadFile(e.name,e.type,e,t,n).then(function(){return p.getFile(e.name,t,n)})},p.deleteFile=function(e,t,n){return r.deleteFile(e,t,n)},p.deleteTeamMember=function(e){return a.apiRequest("DELETE",l.API_URL+"/api/v1/users/"+e.user_id)},p.editTeamMember=function(e){var n=e.user_id,r=e.email,i=e._pristine,s=a.stripProfileAttributes(o.clean(e)),u=[];return r!==i.email&&u.push(a.apiRequest("PUT",l.API_URL+"/api/v1/users/"+n+"/email",{email:r})),u.push(a.apiRequest("PATCH",l.API_URL+"/api/v1/users/"+n+"/metadata",s)),t.all(u).then(function(){return m(e)})},p.addTeamMember=function(e){return a.apiRequest("POST",l.API_URL+"/api/v1/users",e).then(m)},p.getTeamMembers=function(){return a.apiRequest("GET",l.API_URL+"/api/v1/users").then(function(e){return _.map(e,m)})},p.canRemoveRole=function(e){return a._isAdmin?!0:e===u.TEAM_OWNER||e===u.REACTOR_ADMIN?!1:!0},p}e.$inject=["$log","$q","DynamodbService","S3Service","PromisifyService","auth","CleanService","AwsConfig","Auth0Config","AUTH_ROLES","promiseCache"],angular.module("reactorCmd").factory("TeamService",e)}(),function(){"use strict";function e(e){return{restrict:"EA",require:"ngModel",scope:{options:"=?",control:"=?"},link:function(t,n,r,i){function a(){e.cancel(o),o=e(function(){var e=_.isArray(i.$modelValue)?i.$modelValue:[i.$modelValue];_.each(e,function(e){t.control.addItem(e)})})}var o,s=_.extend({},t.options);r.multiple&&(s.plugins=s.plugins||[],s.plugins.push("remove_button")),t.control=n.selectize(s)[0].selectize,i.$formatters.push(function(e){return a(),e})}}}e.$inject=["$timeout"],angular.module("reactorCmd").directive("selectize",e)}(),function(){"use strict";function e(e){var t={},n=(e.get("CleanService"),/^[$$_]/);return t.clean=function(e){return _.omitRecursively(e,function(e,t){return n.test(t)})},t}_.mixin({omitRecursively:function(e,t,n){return _.mapValues(_.omit(e,t,n),function(e){return _.isObject(e)&&!_.isArray(e)?_.omitRecursively(e,t,n):e})}}),e.$inject=["$log"],angular.module("reactorCmd").factory("CleanService",e)}(),function(){"use strict";function e(e,t,n,r,i){function a(e){return _.mapValues(e,function(e){return _.has(e,"S")?e.S:e})}var o={},s=e.get("DynamodbService"),l=new AWS.DynamoDB({region:i.REGION});return o.init=function(e){l.config.credentials=e},o.getTeam=function(e){s.debug("getTeam() teamName=%s",e);var o={};return o.TableName=i.TEAM_TABLE,o.ScanFilter={},o.ScanFilter.team_id={},o.ScanFilter.team_id.ComparisonOperator="EQ",o.ScanFilter.team_id.AttributeValueList=[{S:e}],n.busy(),t.single(_.bind(l.scan,l),o).then(function(e){return _.map(e.Items,a)}).catch(_.partial(r.error,s)).finally(n.idle)},o.getTeams=function(){s.debug("getTeams()");var e={};return e.TableName=i.TEAM_TABLE,n.busy(),t.single(_.bind(l.scan,l),e).then(function(e){return _.map(e.Items,a)}).catch(_.partial(r.error,s)).finally(n.idle)},o.getFiles=function(e){s.debug("getFiles() team=%s",e);var o={};return o.TableName=i.FILES_TABLE,o.ScanFilter={},o.ScanFilter.team_id={},o.ScanFilter.team_id.ComparisonOperator="EQ",o.ScanFilter.team_id.AttributeValueList=[{S:e}],n.busy(),t.single(_.bind(l.scan,l),o).then(function(e){return _.map(e.Items,a)}).catch(_.partial(r.error,s)).finally(n.idle)},o.getPresentations=function(e){s.debug("getPresentations() team=%s",e);var o={};return o.TableName=i.PRESENTATIONS_METADATA_TABLE,o.ScanFilter={},o.ScanFilter.team_id={},o.ScanFilter.team_id.ComparisonOperator="EQ",o.ScanFilter.team_id.AttributeValueList=[{S:e}],n.busy(),t.single(_.bind(l.scan,l),o).then(function(e){return _.map(e.Items,a)}).catch(_.partial(r.error,s)).finally(n.idle)},o}e.$inject=["$log","PromisifyService","LoadingService","ErrorService","AwsConfig"],angular.module("reactorCmd").factory("DynamodbService",e)}(),function(){"use strict";function e(){var e={};return e.error=function(e,t){e.warn("Error occurred, error=%o",t)},e.warn=function(e,t){e.warn("Warning occurred, warning=%o",t)},e}angular.module("reactorCmd").factory("ErrorService",e)}(),function(){"use strict";function e(){var e={},t={};return e.listen=function(e,n){t[e]=t[e]||[],t[e].push(n)},e.emit=function(){var e=Array.prototype.slice.call(arguments),n=e.shift();if(t[n])for(;t[n].length;){var r=t[n].shift();r.apply(r,e)}},e}angular.module("reactorCmd").factory("EventService",e)}(),function(){"use strict";function e(){}function t(e,t){function n(){t.inc()}var r,i={};return i.busy=function(a,o){t.start(),o||(r=e(n)),i.isBusy=!0,i.busyKeys[a]=!0},i.idle=function(n){r&&e.cancel(r),t.complete(),i.isBusy=!1,delete i.busyKeys[n]},i.set=function(e){t.set(e)},i.isBusy=!1,i.busyKeys={},i}e.$inject=["cfpLoadingBarProvider"],t.$inject=["$interval","cfpLoadingBar"],angular.module("reactorCmd").config(e).factory("LoadingService",t).run(["$rootScope","LoadingService",function(e,t){e.loading=t}])}(),function(){"use strict";function e(e){var t={};return t.single=function(){var t=Array.prototype.slice.call(arguments),n=t.shift(),r=e.defer();return t.push(function(e,t){e?r.reject(e):r.resolve(t)}),n.apply(this,t),r.promise},t.double=function(){var t=Array.prototype.slice.call(arguments),n=t.shift(),r=e.defer();return t.push(function(){r.resolve(arguments)}),t.push(function(e){r.reject(e)}),n.apply(this,t),r.promise},t.success=function(t){var n=e.defer();return n.resolve(t),n.promise},t.failure=function(t){var n=e.defer();return n.reject(t),n.promise},t}e.$inject=["$q"],angular.module("reactorCmd").factory("PromisifyService",e)}(),function(){"use strict";function e(e,t,n,r,i){function a(e,t){return t?e+"/"+t:e}var o={},s=e.get("S3Service"),l=new AWS.S3;return o.init=function(e){l.config.credentials=e},o.getFile=function(e,t,o){return s.debug("getFile() key=%s bucket=%s prefix=%s",e,t,o),i.busy(),n.single(_.bind(l.getObject,l),{Bucket:a(t,o),Key:e}).then(function(e){return _.omit(e,"Body")}).catch(_.partial(r.error,s)).finally(i.idle)},o.getFiles=function(e,a){return s.debug("getFiles() bucket=%s prefix=%s",e,a),i.busy(),o.ensureBucketExists(e).then(function(){return n.single(_.bind(l.listObjects,l),{Bucket:e,Prefix:a}).then(function(n){s.debug("getFiles() response=%o",n);var r=_.reject(n.Contents,{Key:a+"/"}),i=_.map(r,function(t){return o.getFile(t.Key,e).then(function(e){return _.extend(t,e)})});return t.all(i)})}).catch(_.partial(r.error,s)).finally(i.idle)},o.ensureBucketExists=function(e){return n.single(_.bind(l.headBucket,l),{Bucket:e}).catch(function(){return o.createBucket(e)})},o.createBucket=function(e){return s.debug("createBucket() bucket=%s",e),i.busy(),n.single(_.bind(l.createBucket,l),{Bucket:e}).catch(_.partial(r.error,s)).finally(i.idle)},o.uploadFile=function(e,n,o,u,c){var m={Key:e,ContentType:n,Body:o,Bucket:a(u,c)};s.debug("uploadFile() params=%o bucket=%s prefix=%s",m,u,c);var d=t.defer(),f="S3Service.uploadFile";i.busy(f,!0);var g=l.putObject(m,function(e,t){e?(r.error(s,e),d.reject(e)):d.resolve(t),i.idle(f)}),p=0;return g.on("httpUploadProgress",function(e){var t=e.loaded/e.total;t>p&&(p=t,i.set(t),s.debug("uploadFile() decimal=%f",t))}).send(),d.promise},o.deleteFile=function(e,t,a){var o={Key:e.Key,Bucket:t};return s.debug("deleteFile() params=%o bucket=%s prefix=%s",o,t,a),i.busy(),n.single(_.bind(l.deleteObject,l),o).catch(_.partial(r.error,s)).finally(i.idle)},o.backupFile=function(e,t,o){t=a(t,o);var u={Bucket:t,CopySource:t+"/"+e,Key:e+"."+moment().format()};return s.debug("backupFile() params=%o bucket=%s prefix=%s",u,t,o),i.busy(),n.single(_.bind(l.copyObject,l),u).catch(_.partial(r.error,s)).finally(i.idle)},o.getSignedAssetUrl=function(e,t,n,r){s.debug("getSignedAssetUrl() bucket=%s prefix=%s, key=%s contentType=%s",e,t,n,r);var i={Bucket:a(e,t),Key:n,Expires:3600};return _.isUndefined(r)||(i.ResponseContentType=r),l.getSignedUrl("getObject",i)},o}e.$inject=["$log","$q","PromisifyService","ErrorService","LoadingService"],angular.module("reactorCmd").factory("S3Service",e)}(),function(){"use strict";function e(e){e.state("login",{url:"/login",controller:"LoginCtrl",controllerAs:"loginCtrl",templateUrl:"components/auth/login/login.html"}).state("logout",{url:"/logout",controller:"LogoutCtrl"})}function t(e,t){t.logout(),e.go("login")}function n(e,t){var n=this;n.login=function(){return t.auth().then(function(){e.go("dashboard")})}}e.$inject=["$stateProvider"],t.$inject=["$state","auth"],n.$inject=["$state","auth","$location"],angular.module("reactorCmd").config(e).controller("LoginCtrl",n).controller("LogoutCtrl",t)}(),function(){"use strict";function e(e){var t=this;t.confirm=function(){e.close(!0)},t.cancel=function(){e.dismiss("cancel")}}e.$inject=["$modalInstance"],angular.module("reactorCmd").controller("ConfirmDialogCtrl",e)}(),function(){"use strict";function e(e){var t=this;t.refresh=function(){e.close(!0)},t.cancel=function(){e.dismiss("cancel")}}e.$inject=["$modalInstance","Auth0Config","auth","$location","$window"],angular.module("reactorCmd").controller("Auth0AuthDialogCtrl",e)}(),function(){"use strict";function e(e,t){e.get("TeamList");return{restrict:"E",templateUrl:"components/team/list/team.list.html",link:function(e){t.getAvailableTeams().then(function(t){e.teams=t})}}}e.$inject=["$log","TeamService"],angular.module("reactorCmd").directive("teamList",e)}(),function(){"use strict";function e(e){e.state("team",{"abstract":!0,url:"/team/:id",controller:"TeamViewCtrl",controllerAs:"teamViewCtrl",templateUrl:"components/team/view/team.view.html"})}function t(e){var t=this;t.teamName=e.id}e.$inject=["$stateProvider"],t.$inject=["$stateParams"],angular.module("reactorCmd").config(e).controller("TeamViewCtrl",t)}(),function(){"use strict";function e(e,t,n,r){var i=this;i.cancel=function(){e.dismiss("cancel")},i.save=function(){t=i.slide,e.close(t)},i.slide=_.extend({},t),i.slideCount=r,i.images={options:{labelField:"name",valueField:"name",sortField:"name",searchField:"name",render:{option:function(e,t){return'<div><p><span class="label label-success">'+t(e.name)+'</span></p><img src="'+e.url+'" class="img-large img-thumbnail"></div>'}},options:_(n).mapValues(function(e,t){return _.extend({name:t},e)}).filter({type:"image"}).value()}},i.videos={options:{labelField:"name",valueField:"name",sortField:"name",searchField:"name",render:{option:function(e,t){return'<div><p><span class="label label-success">'+t(e.name)+'</span></p><video controls src="'+e.url+'"></video></div>'}},options:_(n).mapValues(function(e,t){return _.extend({name:t},e)}).filter({type:"video"}).value()}}}e.$inject=["$modalInstance","$$slide","$$manifest","$$slideCount"],angular.module("reactorCmd").controller("PresentationSlideEditDialogCtrl",e)}(),function(){"use strict";function e(e){e.state("team.capture",{url:"/capture",controller:"TeamViewCaptureCtrl",controllerAs:"teamViewCaptureCtrl",templateUrl:"components/team/view/capture/team.view.capture.html"})}function t(e,t,n,r,i,a){function o(){r.getTeam(s.teamName).then(function(e){r.getAssets(e).then(function(e){l.debug("assets=%o",e),s.assets=_.map(e,function(e){return e._uploadDate=moment(e.upload_date).format("MM-DD-YYYY"),e._createDate=moment(e.create_date).format("MM-DD-YYYY"),e}),s.updateAssetTable()})})}var s=this,l=e.get("TeamViewCaptureCtrl");s.teamName=t.id,s.query=null,s.assets=[],s.assetTable=new i({page:1,count:10,sorting:{_uploadDate:"asc"}},{$scope:{$data:{}},getData:function(e,t){t.total(s.assets.length);var n=s.assets;t.sorting()&&(n=a("orderBy")(n,t.orderBy()));var r=new RegExp(s.query,"i");n=_.filter(n,function(e){return!s.query||!s.query.length||r.test(e.description)}),e.resolve(n.slice((t.page()-1)*t.count(),t.page()*t.count()))}}),s.updateAssetTable=_.debounce(function(){s.assetTable.reload()}),s.download=function(){_.each(s.assets,function(e){e._selected&&window.open(e._downloadUrl)})},o()}e.$inject=["$stateProvider"],t.$inject=["$log","$stateParams","auth","TeamService","ngTableParams","$filter"],angular.module("reactorCmd").config(e).controller("TeamViewCaptureCtrl",t)}(),function(){"use strict";function e(e,t,n,r,i,a,o,s){{var l=this;e.get("TeamMemberEditCtrl")}l.editMode="edit"===n,l.addMode=!l.editMode,l.pristineMember=_.extend({},r),l.member=r,_.defaults(l.member,{roles:[a.USER],connection:"Username-Password-Authentication"}),l.roles={options:{labelField:"label",valueField:"id",sortField:"label",searchField:"label",onDelete:function(e){return _.every(e,s.canRemoveRole)},options:_.map(t._visibleRoles,function(e){return{id:e,label:e}})}},l.team={options:{labelField:"label",valueField:"id",sortField:"label",searchField:"label",options:_.chain(o).filter(function(){return t._isAdmin}).map(function(e){return{id:e.team_id,label:e.team_id}}).value()}},l.cancel=function(){return _.extend(l.member,l.pristineMember),i.dismiss("cancel")},l.add=function(){return s.addTeamMember(l.member).then(function(e){return i.close(e)}).catch(function(e){l.error=e.data.error_description||e.data})},l.edit=function(){return s.editTeamMember(l.member).then(function(e){return i.close(e)}).catch(function(e){l.error=e.data.error_description||e.data})}}e.$inject=["$log","auth","$$mode","$$member","$modalInstance","AUTH_ROLES","$$teams","TeamService"],angular.module("reactorCmd").controller("TeamMemberEditCtrl",e)}(),function(){"use strict";function e(e){e.state("team.files",{url:"/files",controller:"TeamViewFilesCtrl",controllerAs:"teamViewFilesCtrl",templateUrl:"components/team/view/files/team.view.files.html"})}function t(e,t,n,r,i,a,o,s,l){function u(){r.getTeam(m.teamName).then(function(e){m.team=e,r.getFiles(e).then(function(e){m.files=_.map(e,c),d.debug("files=%o",m.files),m.updateFilesTable()})})}function c(e){return e._createDate=moment(e.LastModified).format("MM-DD-YYYY"),e}var m=this,d=e.get("TeamViewFilesCtrl");m.teamName=t.id,m.team=null,m.query=null,m.files=[],m.filesTable=new n({page:1,count:10,sorting:{Key:"asc"}},{$scope:{$data:{}},getData:function(e,t){var n=m.files;t.total(n.length),t.sorting()&&(n=i("orderBy")(n,t.orderBy()));var r=new RegExp(m.query,"i");n=_.filter(n,function(e){return!m.query||!m.query.length||r.test(e.Key)}),e.resolve(n.slice((t.page()-1)*t.count(),t.page()*t.count()))}}),m.updateFilesTable=_.debounce(function(){m.filesTable.reload()}),m.onFileSelect=function(e){var t=_.map(e,function(e){return r.uploadFile(e.name,e.type,e,m.team.cms_s3_bucket,m.team.cms_s3_bucket_prefix)});l.all(t).then(function(e){d.debug("uploaded files",e),m.files=m.files.concat(_.map(e,c)),m.updateFilesTable()})},m.deleteFile=function(e){return o.show(s.CONFIRM).then(function(t){return t?r.deleteFile(e,m.team.cms_s3_bucket,m.team.cms_s3_bucket_prefix).then(function(){_.remove(m.files,{Key:e.Key}),m.updateFilesTable()}):void 0})},u()}e.$inject=["$stateProvider"],t.$inject=["$log","$stateParams","ngTableParams","TeamService","$filter","$modal","DialogService","DIALOGS","$q"],angular.module("reactorCmd").config(e).controller("TeamViewFilesCtrl",t)}(),function(){"use strict";function e(e){e.state("team.members",{url:"/members",controller:"TeamViewMembersCtrl",controllerAs:"teamViewMembersCtrl",templateUrl:"components/team/view/members/team.view.members.html"})}function t(e,t,n,r,i,a,o){function s(e,t){return i.open({templateUrl:"components/team/view/edit/team.member.edit.html",controller:"TeamMemberEditCtrl",controllerAs:"teamMemberEditCtrl",resolve:{$$mode:function(){return e},$$member:function(){return t},$$teams:["TeamService",function(e){return e.getAvailableTeams()}]}})}function l(){n.getTeamMembers(u.teamName).then(function(e){u.members=e,u.updateTeamTable()})}var u=this;u.teamName=e.id,u.query=null,u.members=[],u.teamTable=new t({page:1,count:10,sorting:{_displayNameLowerCase:"asc"}},{$scope:{$data:{}},getData:function(e,t){t.total(u.members.length);var n=u.members;t.sorting()&&(n=r("orderBy")(n,t.orderBy()));var i=new RegExp(u.query,"i");n=_.filter(n,function(e){return!u.query||!u.query.length||i.test(e._displayName)}),e.resolve(n.slice((t.page()-1)*t.count(),t.page()*t.count()))}}),u.updateTeamTable=_.debounce(function(){u.teamTable.reload()}),u.showAdd=function(){return s("add",{team:u.teamName}).result.then(function(e){u.members.push(e),u.updateTeamTable()})},u.showEdit=function(e){return s("edit",e)},u.deleteMember=function(e){return a.show(o.CONFIRM).then(function(t){return t?n.deleteTeamMember(e).then(function(){_.remove(u.members,{user_id:e.user_id}),u.updateTeamTable()}):void 0})},l()}e.$inject=["$stateProvider"],t.$inject=["$stateParams","ngTableParams","TeamService","$filter","$modal","DialogService","DIALOGS"],angular.module("reactorCmd").config(e).controller("TeamViewMembersCtrl",t)}(),function(){"use strict";function e(e){e.state("team.presentations",{url:"/presentations",controller:"TeamViewPresentationsCtrl",controllerAs:"teamViewPresentationsCtrl",templateUrl:"components/team/view/presentations/team.view.presentations.html"})}function t(e,t,n,r,i,a,o,s){function l(){r.getPresentations(u.teamName).then(function(e){u.presentations=_.map(e,function(e){return e._createDate=moment(e.create_date).format("MM-DD-YYYY"),e}),c.debug("presentations=%o",u.presentations),u.updatePresentationsTable()})}var u=this,c=e.get("TeamViewPresentationsCtrl");u.teamName=t.id,u.query=null,u.presentations=[],u.presentationsTable=new n({page:1,count:10,sorting:{_displayNameLowerCase:"asc"}},{$scope:{$data:{}},getData:function(e,t){var n=u.presentations;t.total(n.length),t.sorting()&&(n=i("orderBy")(n,t.orderBy()));var r=new RegExp(u.query,"i");n=_.filter(n,function(e){return!u.query||!u.query.length||r.test(e.title)}),e.resolve(n.slice((t.page()-1)*t.count(),t.page()*t.count()))}}),u.updatePresentationsTable=_.debounce(function(){u.presentationsTable.reload()}),u.loadLocalPresentation=function(e){var t=_.extend({},s.PRESENTATION,{backdrop:"static",keyboard:!1,size:"lg",resolve:{$$url:function(){return e.s3_key},$$presentationObj:function(){return e}}});o.show(t)},u.loadPresentation=function(e){var t=_.extend({},s.PRESENTATION,{backdrop:"static",keyboard:!1,size:"lg",resolve:{$$url:function(){return e._downloadUrl},$$presentationObj:function(){return e}}});o.show(t)},l()}e.$inject=["$stateProvider"],t.$inject=["$log","$stateParams","ngTableParams","TeamService","$filter","$modal","DialogService","DIALOGS"],angular.module("reactorCmd").config(e).controller("TeamViewPresentationsCtrl",t)}(),function(){"use strict";function e(e){e.state("team.summary",{url:"/",controller:"TeamViewSummaryCtrl",controllerAs:"teamViewSummaryCtrl",templateUrl:"components/team/view/summary/team.view.summary.html"})}function t(){}e.$inject=["$stateProvider"],angular.module("reactorCmd").config(e).controller("TeamViewSummaryCtrl",t)}();